# Дискорд Бот для прослушивания Яндекс Музыки

> [!NOTE]
> Этот функционал проигрывания треков из Яндекс Музыки изначально был реализован в теме [YandexMusicDiscordBot](https://github.com/Delitel-WEB/YandexMusicDiscordBot).<br />
> Но после использования бота, я понял, что его ещё нужно доделать и добавить новые функции. Поэтому и опубликовал fork этого проекта. Где исправил всё что было замечено за неделю использования, а также добавил новые функции.<br />
> Вы также можете пригласить моего улучшенного бота, который выполняет только роль проигрывания музыки Yandex - [Yandex Music](https://discord.com/api/oauth2/authorize?client_id=1171294403072118854&permissions=8&scope=bot)

## Что умеет этот бот?
- Проигрывание Треков/Альбомов/Плейлистов/Подкастов/Аудиокниг из Яндекс.Музыки
- Формирование очереди из Треков/Альбомов/Плейлистов.<br />
![queue](https://github.com/llimonix/YandexMusicDiscordBotReworked/assets/58168234/26c8d019-8410-4238-8d8f-33e5a3c9d300)
- Полноценный МедиПлеер. _(Данные пользовательские смайлики поддерживаются на всех серверах, если бот был добавлен в канал с этими смайликами. Сюда же я залил версию без них. Если будет интересно как это сделать, то я залью обновленную версию, где вы сможете указывать свои пользовательские смайлики)_<br />
![image](https://github.com/llimonix/YandexMusicDiscordBotReworked/assets/58168234/027e8599-54e8-4dac-ba10-f57992053f69)
- Пропуск как одного трека так и плейлиста.
- Остановка проигрывание и его возобновление с помощью медиаплеера.
- Отслеживание активности в голосовом чате.
    - Если в голосов канале нет никого кроме бота в течении 3-х минут он останавливает проигрывание и выходит из голосового чата.
- `Защита от дурака`
    - Если бота отключат не с помощью медиаплеера бот спокойно закончит проигрывание.
    - Интерактивные кнопки в медиаплеере доступны только тем пользователям которые в данный момент находятся в одном голосовом канале с ботом.
- Поиск Трека/Альбома/Плейлиста/Подкаста/Аудиокниги как с помощью прямой ссылки так и с помощью обычного запроса.

### **Добавленное в моей версии Reworked**

- Повтор трека, который играет в данный момент, пока не отключишь эту функцию
- Похожие треки. Находит похожие треки по треку, который играет в данный момент. Если были найдены, создаен новый плелист с ними
- Перемешать все треки во всех плейлистах в случайном порядке (сделанно для тех, кто часто запускает один и тот же плейлист и хочет слушать песни в другом порядке)
- Теперь вместо удаления сообщения и создания нового при переключении песен, он просто редактирует уже имеющееся
- Так же теперь полоса от сообщения Embed подстраивается под среднее значенее цветов из обложки трека
- Много мелких исправлений, когда что то вызывало непредвиденные ошибки


### Необходимые зависимости
Для работы бота вам необходим ffmpeg
Чтобы скачать его в linux(ubuntu):
```shell
 apt install ffmpeg
```
в Windows:
Вам необходимо скачать ffmpeg [здесь](https://ffmpeg.org/).
И в bot.music.event_loop.py на [этой строке](bot/music/event_loop.py#L79) указать путь до вашего ffmpeg:
```python
voiceManager.voiceClient.play(FFmpegOpusAudio(normalized_audio.export(format='wav'), pipe=True, executable="ffmpeg.exe"))
```
Не забудьте прописать в системных переменных путь до скачанного ffmpeg
![image](https://github.com/llimonix/YandexMusicDiscordBotReworked/assets/58168234/61402f0a-577b-4d15-9285-4a67376e9b99)


Также необходимо установить необходимые библиотеки:
```cmd
pip install -r req.txt
```

## Настройка
В [bot.py](bot/cfg.py) находятся токены Яндекс.Музыки и Дискорд Бота которые необходимы для запуска бота.

Вы можете как 
Заменить это:
```python
token = os.environ["discordBotToken"]
YMToken = os.environ["YMTOKEN"]
```
на это:
```python
token = "MyDiscordToken"
YMToken = "MyYMToken"
```
Также вы можете использовать токены из переменных сред как это изначально задумывалось.

О том как получить токен Яндекс.Музыки вы можете узнать [здесь](https://github.com/MarshalX/yandex-music-api/discussions/513).


## Запуск бота
```cmd
python main.py
```
